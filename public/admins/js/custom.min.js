$(function() {
    "use strict";
    $(function() {
        $(".preloader").fadeOut();
    }), jQuery(document).on("click", ".mega-dropdown", function(e) {
        e.stopPropagation();
    });
    var set = function() {
        (window.innerWidth > 0 ? window.innerWidth : this.screen.width) < 1170 ? ($("body").addClass("mini-sidebar"), 
            $(".navbar-brand span").hide(), $(".sidebartoggler i").addClass("ti-menu")) : ($("body").removeClass("mini-sidebar"), 
            $(".navbar-brand span").show());
            var height = (window.innerHeight > 0 ? window.innerHeight : this.screen.height) - 1;
            (height -= 0) < 1 && (height = 1), height > 0 && $(".page-wrapper").css("min-height", height + "px");
        };
        $(window).ready(set), $(window).on("resize", set), $(".sidebartoggler").on("click", function() {
            $("body").hasClass("mini-sidebar") ? ($("body").trigger("resize"), $("body").removeClass("mini-sidebar"), 
                $(".navbar-brand span").show()) : ($("body").trigger("resize"), $("body").addClass("mini-sidebar"), 
                $(".navbar-brand span").hide());
            }), $(".nav-toggler").click(function() {
                $("body").toggleClass("show-sidebar"), $(".nav-toggler i").toggleClass("ti-menu"), 
                $(".nav-toggler i").addClass("ti-close");
            }), $(".search-box a, .search-box .app-search .srh-btn").on("click", function() {
                $(".app-search").toggle(200);
            }), $(".right-side-toggle").click(function() {
                $(".right-sidebar").slideDown(50), $(".right-sidebar").toggleClass("shw-rside");
            }), $(".floating-labels .form-control").on("focus blur", function(e) {
                $(this).parents(".form-group").toggleClass("focused", "focus" === e.type || this.value.length > 0);
            }).trigger("blur"), $(function() {
                for (var url = window.location, element = $("ul#sidebarnav a").filter(function() {
                    return this.href == url;
                }).addClass("active").parent().addClass("active"); ;) {
                    if (!element.is("li")) break;
                    element = element.parent().addClass("in").parent().addClass("active");
                }
            }), $(function() {
                $('[data-toggle="tooltip"]').tooltip();
            }), $(function() {
                $('[data-toggle="popover"]').popover();
            }), $(function() {
                $("#sidebarnav").AdminMenu();
            }), //$(".scroll-sidebar, .right-side-panel, .message-center, .right-sidebar").perfectScrollbar(),
            $(".scroll-sidebar").mCustomScrollbar({
                setHeight: 550,
                autoHideScrollbar: true,
                scrollbarPosition: "outside",
                theme:"dark-1" 
            }),
            $("body").trigger("resize"), $(".list-task li label").click(function() {
                $(this).toggleClass("task-done");
            }), $('a[data-action="collapse"]').on("click", function(e) {
                e.preventDefault(), $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"), 
                $(this).closest(".card").children(".card-body").collapse("toggle");
            }), $('a[data-action="expand"]').on("click", function(e) {
                e.preventDefault(), $(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"), 
                $(this).closest(".card").toggleClass("card-fullscreen");
            }), $('a[data-action="close"]').on("click", function() {
                $(this).closest(".card").removeClass().slideUp("fast");
            });
        });

$(document).ready(function() {
    //Validación para introducir solo números
    $('.number, #phone, #dni').keypress(function() {
        return event.charCode >= 48 && event.charCode <= 57;
    });
    //Validación para introducir solo letras y espacios
    $('#name, #lastname, .only-letters').keypress(function() {
        return event.charCode >= 65 && event.charCode <= 90 || event.charCode >= 97 && event.charCode <= 122 || event.charCode==32;
    });
    //Validación para solo presionar enter y borrar
    $('.date, .dateTime, .date-prev').keypress(function() {
        return event.charCode == 32 || event.charCode == 127;
    });

    //datatable español
    var español = {
        "sProcessing":     "Procesando...",
        "sLengthMenu":     "Mostrar _MENU_ registros",
        "sZeroRecords":    "No se encontraron resultados",
        "sEmptyTable":     "Ningún resultado disponible en esta tabla",
        "sInfo":           "Resultados del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty":      "No hay resultados",
        "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
        "sInfoPostFix":    "",
        "sSearch":         "Buscar :",
        "sUrl":            "",
        "sInfoThousands":  ",",
        "sLoadingRecords": "Cargando...",
        "oPaginate": {
            "sFirst":    "Primero",
            "sLast":     "Último",
            "sNext":     "Siguiente",
            "sPrevious": "Anterior"
        },
        "oAria": {
            "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
        }
    }

    //datatable export
    if ($('#tablaExport').length) {
        $('#tablaExport').DataTable({
            dom: 'Bfrtip',
            buttons: ['excel', 'pdf'],
            "language": español
        });
    }

    //datatable normal
    if ($('#tabla').length) {
        $('#tabla').DataTable({
            "language": español
        });
    }

    //datepicker material
    if ($('.date').length) {
        $('.date').bootstrapMaterialDatePicker({
            lang : 'es',
            time: false,
            cancelText: 'Cancelar',
            clearText: 'Limpiar',
            format: 'DD-MM-YYYY',
            minDate : new Date()
        });
    }

    if ($('.dateTurn').length) {
        var dateTurn;
        if (moment().format("HH")>18) {
            dateTurn=moment().add(1, 'days').format('DD-MM-YYYY');
        } else {
            dateTurn=new Date();
        }    
        $('.dateTurn').bootstrapMaterialDatePicker({
            lang : 'es',
            time: false,
            cancelText: 'Cancelar',
            clearText: 'Limpiar',
            format: 'DD-MM-YYYY',
            minDate : dateTurn
        });
    }

    if ($('.timeTurn').length) {
        $('.timeTurn').bootstrapMaterialDatePicker({
            lang : 'es',
            date: false,
            time: true,
            cancelText: 'Cancelar',
            clearText: 'Limpiar',
            format: 'h:mm a',
            minDate : '08:00:00',
            maxDate : '19:00:00'
        });
    }

    if ($('.date-prev').length) {
        $('.date-prev').bootstrapMaterialDatePicker({
            lang : 'es',
            time: false,
            cancelText: 'Cancelar',
            clearText: 'Limpiar',
            format: 'D-M-YYYY',
            maxDate : new Date()
        });
    }

    //multiselect
    if ($('.multiselect').length) {
        $('.multiselect').multiselect({
            buttonClass: 'form-control',
            buttonWidth: '100%',
            maxHeight: 200,
            includeSelectAllOption: false,
            selectAllText: 'Seleccionar Todas',
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            filterPlaceholder: 'Buscar',
            includeFilterClearBtn: true,
            nonSelectedText: 'Seleccione',
            nSelectedText: 'Selecionados',
            allSelectedText: 'Todos Selecionados',
            numberDisplayed: 2,
            disableIfEmpty: true,
            disabledText: 'Seleccione',
            templates: {
                button: '<button type="button" style="text-align: left;" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> <b class="caret" style="text-align: right;"></b></button>',
                ul: '<ul class="multiselect-container dropdown-menu"></ul>',
                filter: '<li class="multiselect-item multiselect-filter"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span><input class="form-control multiselect-search" type="text" /></div></li>',
                filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="fa fa-close"></i></button></span>',
                li: '<li style="margin-left: -25px;"><a tabindex="0"><label style="color: #000; width: 100%;"></label></a></li>',
                divider: '<li class="multiselect-item divider"></li>',
                liGroup: '<li class="multiselect-item multiselect-group"><label></label></li>',
                resetButton: '<li class="multiselect-reset text-center"><div class="input-group"><a class="btn btn-default btn-block"></a></div></li>'
            }
        });
    }

    //multiselect Select2
    if ($('.select2').length) {
        $('.select2').select2({
            placeholder: "Seleccione",
            theme: "bootstrap",
            language: "es"
        });
    }

    //touchspin para los campos numericoSs
    if ($('.decimal').length) {
        $(".decimal").TouchSpin({
            min: 0,
            max: 99999999999,
            step: 0.5,
            decimals: 1,
            buttondown_class: 'btn btn-primary',
            buttonup_class: 'btn btn-primary'
        });
    }

    if ($('.int').length) {
        $(".int").TouchSpin({
            min: 0,
            max: 99999999999,
            buttondown_class: 'btn btn-primary',
            buttonup_class: 'btn btn-primary'
        });
    }

    if ($('.franchist').length) {
        $(".franchist").TouchSpin({
            min: 0,
            max: 99999999999,
            step: 0.5,
            decimals: 1,
            buttondown_class: 'btn btn-primary',
            buttonup_class: 'btn btn-primary'
        });
    }

    // if ($('.ofert').length) {
    //     $(".ofert").TouchSpin({
    //         min: 0,
    //         max: 100,
    //         postfix: '%',
    //         buttondown_class: 'btn btn-primary',
    //         buttonup_class: 'btn btn-primary'
    //     });
    // }

    // if ($('.price').length) {
    //     $(".price").TouchSpin({
    //         min: 0,
    //         max: 99999999999,
    //         decimals: 2,
    //         prefix: '$',
    //         buttondown_class: 'btn btn-primary',
    //         buttonup_class: 'btn btn-primary'
    //     });
    // }

    //dropify para input file más personalizado
    if ($('.dropify').length) {
        $('.dropify').dropify({
            messages: {
                default: 'Arrastre y suelte una imagen o da click para seleccionarla',
                replace: 'Arrastre y suelte una imagen o haga click para reemplazar',
                remove: 'Remover',
                error: 'Lo sentimos, el archivo es demasiado grande'
            },
            error: {
                'fileSize': 'El tamaño del archivo es demasiado grande ({{ value }} máximo).',
                'minWidth': 'El ancho de la imagen es demasiado pequeño ({{ value }}}px mínimo).',
                'maxWidth': 'El ancho de la imagen es demasiado grande ({{ value }}}px máximo).',
                'minHeight': 'La altura de la imagen es demasiado pequeña ({{ value }}}px mínimo).',
                'maxHeight': 'La altura de la imagen es demasiado grande ({{ value }}px máximo).',
                'imageFormat': 'El formato de imagen no está permitido (Debe ser {{ value }}).'
            }
        });
    }

    //Jquery uploader
    if ($('#drop-area').length) {
        $('#drop-area').dmUploader({
            url: '/imagenes/presupuestos',
            maxFileSize: 20000000,
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            onDragEnter: function(){
                this.addClass('active');
            },
            onDragLeave: function(){
                this.removeClass('active');
            },
            onBeforeUpload: function(){
                $('button[type="submit"]').attr('disabled', true);
                $("#response").text('Subiendo Archivo...');
            },
            onUploadSuccess: function(id, data){
                var obj=data;

                if (obj.status) {
                    $("#images").append($('<div>', {
                        'class': 'form-group col-lg-3 col-md-3 col-sm-6 col-12',
                        'element': id
                    }).append($('<img>', {
                        'src': '/admins/img/vehicles/'+obj.name,
                        'class': 'rounded img-fluid'                            
                    })).append($('<input>', {
                        'type': 'hidden',
                        'name': 'files[]',
                        'value': obj.name                        
                    })).append($('<button>', {
                        'type': 'button',
                        'class': 'btn btn-danger btn-sm btn-circle btn-absolute-right',
                        'image': id,
                        'urlImage': '/admins/img/vehicles/'+obj.name,
                        'onclick': 'deleteImageCreate("'+id+'");'
                    }).append('<i class="fa fa-trash">')));

                    $('button[type="submit"]').attr('disabled', false);
                    $("#response").text('Correcto');
                } else {
                    $('button[type="submit"]').attr('disabled', false);
                    $("#response").text('Error');
                }
            },
            onUploadError: function(id, xhr, status, message){  
                $('button[type="submit"]').attr('disabled', false);
                $("#response").text('Error');
            },
            onFileSizeError: function(file){
                $('button[type="submit"]').attr('disabled', false);
                $("#response").text('El archivo \'' + file.name + '\' excede el tamaño máximo permitido.');
            }
        });
    }

    if ($('#drop-area2').length) {
        var slug=$('#slug').val();
        $('#drop-area2').dmUploader({
            url: '/imagenes/presupuestos/editar/'+slug,
            maxFileSize: 20000000,
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            onDragEnter: function(){
                this.addClass('active');
            },
            onDragLeave: function(){
                this.removeClass('active');
            },
            onBeforeUpload: function(){
                $('button[type="submit"]').attr('disabled', true);
                $("#response").text('Subiendo Archivo...');
            },
            onUploadSuccess: function(id, data){
                var obj=data;

                if (obj.status) {
                    $("#images").append($('<div>', {
                        'class': 'form-group col-lg-3 col-md-3 col-sm-6 col-12',
                        'element': id
                    }).append($('<img>', {
                        'src': '/admins/img/vehicles/'+obj.name,
                        'class': 'rounded img-fluid'                            
                    })).append($('<button>', {
                        'type': 'button',
                        'class': 'btn btn-danger btn-sm btn-circle btn-absolute-right removeImage',
                        'image': id,
                        'urlImage': '/admins/img/vehicles/'+obj.name
                    }).append('<i class="fa fa-trash">')));
                    $('button[type="submit"]').attr('disabled', false);
                    $("#response").text('Correcto');
                    Lobibox.notify('success', {
                        title: 'Registro exitoso',
                        sound: true,
                        msg: 'La imagen ha sido agregada exitosamente.'
                    });

                    //funcion para eliminar imagenes de vehiculos
                    $('.removeImage').on('click', function(event) {
                        var img=$(this).attr('image'), slug=$('#slug').val(), urlImage=event.currentTarget.attributes[3].value;
                        urlImage=urlImage.split('/');
                        if (slug!="") {
                            $.ajax({
                                url: '/imagenes/presupuestos/eliminar',
                                type: 'POST',
                                dataType: 'html',
                                data: {slug: slug, url: urlImage[4]},
                                headers: {
                                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                }
                            })
                            .done(function(resultado) {
                                var obj=JSON.parse(resultado);
                                if (obj.status) {
                                    $("div[element='"+img+"']").remove();
                                    Lobibox.notify('success', {
                                        title: 'Eliminación Exitosa',
                                        sound: true,
                                        msg: 'La imagen ha sido eliminada exitosamente.'
                                    });
                                } else {
                                    Lobibox.notify('error', {
                                        title: 'Eliminación Fallida',
                                        sound: true,
                                        msg: 'Ha ocurrido un problema, intentelo nuevamente.'
                                    });
                                }
                            });
                        }
                    });
                } else {
                    $('button[type="submit"]').attr('disabled', false);
                    $("#response").text('Error');
                    Lobibox.notify('error', {
                        title: 'Eliminación Fallida',
                        sound: true,
                        msg: 'Ha ocurrido un problema, intentelo nuevamente.'
                    });
                }
            },
            onUploadError: function(id, xhr, status, message){  
                $('button[type="submit"]').attr('disabled', false);
                $("#response").text('Error');
                Lobibox.notify('error', {
                    title: 'Eliminación Fallida',
                    sound: true,
                    msg: 'Ha ocurrido un problema, intentelo nuevamente.'
                });
            },
            onFileSizeError: function(file){
                $('button[type="submit"]').attr('disabled', false);
                $("#response").text('El archivo \'' + file.name + '\' excede el tamaño máximo permitido.');
            }
        });
}

    //Fullcalendar de Agenda
    if ($('#schedrule').length) {
        $.ajax({
            url: '/agendas/agregar',
            type: 'POST',
            dataType: 'html',
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);
            if (obj.status) {
                $('#schedrule').fullCalendar({
                    locale: 'es',
                    themeSystem: 'bootstrap4',
                    height: 600,
                    fixedWeekCount: false,
                    header: {
                        left: 'prev,next, today',
                        center: 'title',
                        right: 'month,listMonth'
                    },
                    events: obj.data,
                    eventClick: function(calEvent, jsEvent, view) {
                        $.ajax({
                            url: '/agendas/ver',
                            type: 'POST',
                            dataType: 'html',
                            data: {id: calEvent.id},
                            headers: {
                                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                            }
                        })
                        .done(function(resultado) {
                            var obj=JSON.parse(resultado);
                            if (obj.status) {
                                $('#turnTitle').text('Título: '+obj.title);
                                $('#turnClient').text('Cliente: '+obj.client);
                                $('#turnVehicle').text('Dominio del Vehículo: '+obj.domine);
                                $('#turnDescription').text('Descripción: '+obj.description);
                                $('#turnDate').text('Fecha y hora: '+obj.date+" "+obj.time);
                                $('#turnButtonEdit').attr('onclick', 'editTurn('+obj.id+')');
                                $('#turnButtonComplete').attr('onclick', 'completeTurn('+obj.id+')');
                                $('#turnButtonDelete').attr('onclick', 'deleteTurn('+obj.id+')');
                                if(obj.state==1) {
                                    $('#turnButtonComplete').addClass('d-none');
                                } else {
                                    $('#turnButtonComplete').removeClass('d-none');
                                }
                                $("#turnModal").modal();
                            }
                        });
                    }
                });
            } else {
                $('#schedrule').fullCalendar({
                    locale: 'es',
                    themeSystem: 'bootstrap4',
                    height: 600,
                    fixedWeekCount: false,
                    header: {
                        left: 'today',
                        center: 'title',
                        right: 'month'
                    }
                });
            }
        });
    }

    //Ajax para agregar las notificaciones
    $.ajax({
        url: '/notificaciones/agregar',
        type: 'POST',
        dataType: 'html',
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    })
    .done(function(resultado) {
        var obj=JSON.parse(resultado);
        var state=false;

        if (obj.status) {
            for (var i=obj.data.length-1; i>=0; i--) {
                if (obj.data[i].type==1 || obj.data[i].type==2) {
                    var type="btn-success";
                } else if (obj.data[i].type==3) {
                    var type="btn-danger";
                } else {
                    var type="btn-dark";
                }

                if (obj.data[i].state==0) {
                    state=true;
                }

                $('#notifications').append($('<a>', {
                    onclick: "notification("+obj.data[i].id+");"
                }).append($('<div>', {
                    class: "btn btn-circle "+type
                }).append($('<i>', {
                    class: "fa fa-calendar"
                }))).append($('<div>', {
                    class: "mail-contnet"
                }).append($('<h5>', {
                    text: obj.data[i].title
                })).append($('<span>', {
                    class: "mail-desc",
                    text: obj.data[i].description
                })).append($('<span>', {
                    class: "time",
                    text: moment(obj.data[i].created_at).fromNow()
                }))));
            }

            if (state) {
                $('.notify').removeClass('d-none');
            }
        } else {
            $('#notifications').append($('<a>').append($('<div>', {
                class: "mail-contnet"
            }).append($('<h5>', {
                text: "No hay notificaciones"
            }))));
            $('.allNotifications').addClass('d-none');
        }
    });

    //Mostrar u ocultar campo de tienda en registro y edición de usuarios
    if ($('#typeUser').length) {
        var typeUser=$('#typeUser').val();
        if (typeUser!=2) {
            $('#storeField').addClass('d-none');
        } else {
            $('#storeField').removeClass('d-none');
        }
    }

    $('#typeUser').change(function() {
        $('#storeField option[value=""]').attr('selected', true);;
        if ($(this).val()!=2) {
            $('#storeField').addClass('d-none');
        } else {
            $('#storeField').removeClass('d-none');
        }
    });
});

//Funcion para cambiar el estado de las notificaciones
$('#notificationsButton').click(function() {
    $.ajax({
        url: '/notificaciones/abrir',
        type: 'POST',
        dataType: 'html',
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    })
    .done(function(resultado) {
        var obj=JSON.parse(resultado);
        if (obj.status) {
            $('.notify').addClass('d-none');
        }
    });
});

// Funciones para agregar datos a select
$('#multiselectProvinces').change(function() {
    var id=$('#multiselectProvinces option:selected').val();
    if (id!="") {
        $.ajax({
            url: '/localidades/agregar',
            type: 'POST',
            dataType: 'html',
            data: {id: id},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $("#multiselectLocalities option, #multiselectDistricts option").remove();
            $("#multiselectLocalities, #multiselectDistricts").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $('#multiselectLocalities, #multiselectDistricts').append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));
            for (var i=obj.length-1; i>=0; i--) {
                $('#multiselectLocalities').append($('<option>', {
                    value: obj[i].id,
                    text: obj[i].name
                }));
            }
            $("#multiselectLocalities").attr('disabled', false);

            if($('#addLocality').length) {
                $('#addLocality').removeClass('d-none');
                $('input[name="nameLocality"]').attr('readonly', false);
            }

            if($('#addDistrict').length) {
                $('#addDistrict').addClass('d-none');
                $('input[name="nameDistrict"]').attr('readonly', true);
            }
        });
    } else {
        $("#multiselectLocalities option, #multiselectDistricts option").remove();
        $('#multiselectLocalities, #multiselectDistricts').append($('<option>', {
            value: '',
            text: 'Seleccione'
        }));
        $("#multiselectLocalities, #multiselectDistricts").attr('disabled', true);

        if($('#addLocality').length) {
            $('#addLocality').addClass('d-none');
            $('input[name="nameLocality"]').attr('readonly', true);
        }

        if($('#addDistrict').length) {
            $('#addDistrict').addClass('d-none');
            $('input[name="nameDistrict"]').attr('readonly', true);
        }
    }
});

$('#multiselectLocalities').change(function() {
    var id=$('#multiselectLocalities option:selected').val();
    if (id!="") {
        $.ajax({
            url: '/distritos/agregar',
            type: 'POST',
            dataType: 'html',
            data: {id: id},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $("#multiselectDistricts option").remove();
            $("#multiselectDistricts").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $('#multiselectDistricts').append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));
            for (var i=obj.length-1; i>=0; i--) {
                $('#multiselectDistricts').append($('<option>', {
                    value: obj[i].id,
                    text: obj[i].name
                }));
            }
            $("#multiselectDistricts").attr('disabled', false);

            if($('#addDistrict').length) {
                $('#addDistrict').removeClass('d-none');
                $('input[name="nameDistrict"]').attr('readonly', false);
            }
        });
    } else {
        $("#multiselectDistricts option").remove();
        $('#multiselectDistricts').append($('<option>', {
            value: '',
            text: 'Seleccione'
        }));
        $("#multiselectDistricts").attr('disabled', true);

        if($('#addDistrict').length) {
            $('#addDistrict').removeClass('d-none');
            $('input[name="nameDistrict"]').attr('readonly', true);
        }
    }
});

$('#multiselectBrands').change(function() {
    var id=$('#multiselectBrands option:selected').val();
    if (id!="") {
        $.ajax({
            url: '/modelos/agregar',
            type: 'POST',
            dataType: 'html',
            data: {id: id},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $("#multiselectModels option, #multiselectVersions option").remove();
            $("#multiselectModels, #multiselectVersions").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $('#multiselectModels, #multiselectVersions').append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));
            for (var i=obj.length-1; i>=0; i--) {
                $('#multiselectModels').append($('<option>', {
                    value: obj[i].id,
                    text: obj[i].name
                }));
            }
            $("#multiselectModels").attr('disabled', false);

            if($('#addModel').length) {
                $('#addModel').removeClass('d-none');
                $('input[name="nameModel"]').attr('readonly', false);
            }

            if($('#addVersion').length) {
                $('#addVersion').addClass('d-none');
                $('input[name="nameVersion"]').attr('readonly', true);
            }
        });
    } else {
        $("#multiselectModels option, #multiselectVersions option").remove();
        $('#multiselectModels, #multiselectVersions').append($('<option>', {
            value: '',
            text: 'Seleccione'
        }));
        $("#multiselectModels, #multiselectVersions").attr('disabled', true);

        if($('#addModel').length) {
            $('#addModel').addClass('d-none');
            $('input[name="nameModel"]').attr('readonly', true);
        }

        if($('#addVersion').length) {
            $('#addVersion').addClass('d-none');
            $('input[name="nameVersion"]').attr('readonly', true);
        }
    }
});

$('#multiselectModels').change(function() {
    var id=$('#multiselectModels option:selected').val();
    if (id!="") {
        $.ajax({
            url: '/versiones/agregar',
            type: 'POST',
            dataType: 'html',
            data: {id: id},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $("#multiselectVersions option").remove();
            $("#multiselectVersions").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $('#multiselectVersions').append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));
            for (var i=obj.length-1; i>=0; i--) {
                $('#multiselectVersions').append($('<option>', {
                    value: obj[i].id,
                    text: obj[i].name
                }));
            }
            $("#multiselectVersions").attr('disabled', false);

            if($('#addVersion').length) {
                $('#addVersion').removeClass('d-none');
                $('input[name="nameVersion"]').attr('readonly', false);
            }
        });
    } else {
        $("#multiselectVersions option").remove();
        $('#multiselectVersions').append($('<option>', {
            value: '',
            text: 'Seleccione'
        }));
        $("#multiselectVersions").attr('disabled', true);

        if($('#addVersion').length) {
            $('#addVersion').addClass('d-none');
            $('input[name="nameVersion"]').attr('readonly', true);
        }
    }
});

$('#selectCustomers').change(function() {
    $('#vehicleEmpty, #customerError').addClass('d-none');
    var slug=$('#selectCustomers option:selected').val();
    if (slug!="") {
        $.ajax({
            url: '/vehiculos/agregar',
            type: 'POST',
            dataType: 'html',
            data: {slug: slug},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $("#selectVehicle option").remove();
            $("#selectVehicle").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $('#selectVehicle').append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));

            for (var i=obj.length-1; i>=0; i--) {
                $('#selectVehicle').append($('<option>', {
                    value: obj[i].slug,
                    text: obj[i].domine+" - "+obj[i].brand+" "+obj[i].model+" "+obj[i].version
                }));
            }

            if (obj.status==false) {
                if (obj.msj=="Este cliente no tiene vehículos.") {
                    $('#vehicleEmpty').removeClass("d-none");
                } else if (obj.msj=="Este cliente no existe.") {
                    $('#customerError').removeClass("d-none");
                }
            }
            $("#selectVehicle").attr('disabled', false);
        });
    } else {
        $("#selectVehicle option").remove();
        $('#selectVehicle').append($('<option>', {
            value: '',
            text: 'Seleccione'
        }));
        $("#selectVehicle").attr('disabled', true);
    }
});

$('#selectVehicle').change(function() {
    var slug=$('#selectVehicle option:selected').val();
    if (slug!="") {
        $.ajax({
            url: '/companias/agregar',
            type: 'POST',
            dataType: 'html',
            data: {slug: slug},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $("#vehicleCompany option").remove();
            $("#vehicleCompany").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $('#vehicleCompany').append($('<option>', {
                value: 'Ninguna',
                text: 'Ninguna'
            }));

            for (var i=obj.length-1; i>=0; i--) {
                $('#vehicleCompany').append($('<option>', {
                    value: obj[i].slug,
                    text: obj[i].name
                }));
            }
            $("#vehicleCompany").attr('disabled', false);
            $('#franchistAmount, #alfanumCode').addClass('d-none');
            $('#franchistAmount input, #alfanumCode input').val("");
            $('#franchistAmount input, #alfanumCode input').attr('required', false);
        });
    } else {
        $("#vehicleCompany option").remove();
        $('#vehicleCompany').attr('disabled', true);
        $('#franchistAmount, #alfanumCode').addClass('d-none');
        $('#franchistAmount input, #alfanumCode input').val("");
        $('#franchistAmount input, #alfanumCode input').attr('required', false);
    }
});

$('#vehicleCompany').change(function(event) {
    var company=$('#vehicleCompany option:selected').val();
    if (company!="Ninguna") {
        $('#franchistAmount, #alfanumCode').removeClass('d-none');
        $('#franchistAmount input, #alfanumCode input').val("");
        $('#franchistAmount input, #alfanumCode input').attr('required', true);
    } else {
        $('#franchistAmount, #alfanumCode').addClass('d-none');
        $('#franchistAmount input, #alfanumCode input').val("");
        $('#franchistAmount input, #alfanumCode input').attr('required', false);
    }
});

//Validación de Contraseña en el formulario de Modificar perfil de usuarios
$("#con").on('change',function(){

    var selectValue = $(this).val();
    switch (selectValue) {

        case " ":
        $("#contraseña").css('display','none');
        break;

        case "Si":
        $("#contraseña").css('display','block');
        break;

        case "No":
        $("#contraseña").css('display','none');
        break;

    }

}).change();

//funciones para preguntar al eliminar


function deleteCustomer(slug) {
    $("#deleteCustomer").modal();
    $('#formDeleteCustomer').attr('action', '/clientes/' + slug);
}

function deleteCategory(slug,url) {
    $("#deleteCategory").modal();
    $('#formDeleteCategory').attr('action', url);
}

function deleteProduct(slug) {
    $("#deleteProduct").modal();
    $('#formDeleteProduct').attr('action', '/productos/' + slug);
}

function deleteProvider(slug) {
    $("#deleteProvider").modal();
    $('#formDeleteProvider').attr('action', '/proveedores/' + slug);
}

function deleteSale(slug) {
    $("#deleteSale").modal();
    $('#formDeleteSale').attr('action', '/ventas/' + slug);
}

//funciones para preguntar al activar un usuario
function activateUser(slug) {
    $("#activateUser").modal();
    $('#formActivateUser').attr('action', 'usuarios/activar/' + slug);
}

//funciones para preguntar al desactivar un usuario
function deactivateUser(slug) {
    $("#deactivateUser").modal();
    $('#formDeactivateUser').attr('action', 'usuarios/desactivar/' + slug);
}

//funciones para preguntar al activar un proveedor
function activateProvider(slug) {
    $("#activateProvider").modal();
    $('#formActivateProvider').attr('action', 'proveedores/activar/' + slug);
}

//funciones para preguntar al desactivar un proveedor
function deactivateProvider(slug) {
    $("#deactivateProvider").modal();
    $('#formDeactivateProvider').attr('action', 'proveedores/desactivar/' + slug);
}

//funciones para preguntar al activar un producto
function activateProduct(slug) {
    $("#activateProduct").modal();
    $('#formActivateProduct').attr('action', '/productos/activar/' + slug);
}

//funciones para preguntar al desactivar un producto
function deactivateProduct(slug) {
    $("#deactivateProduct").modal();
    $('#formDeactivateProduct').attr('action', 'productos/desactivar/' + slug);
}

//funciones para preguntar al activar un cliente
function activateCustomer(slug) {
    $("#activateCustomer").modal();
    $('#formActivateCustomer').attr('action', 'clientes/activar/' + slug);
}

//funciones para preguntar al desactivar un cliente
function deactivateCustomer(slug) {
    $("#deactivateCustomer").modal();
    $('#formDeactivateCustomer').attr('action', '/clientes/desactivar/' + slug);
}

//Funcion para rechazar un trabajo
function refuseWork(id) {
    $("#refuseWork").modal();
    $('#formRefuseWork').attr('action', '/trabajos/cancelar/' + id);
}

//Funcion para completar un trabajo
function completeWork(id) {
    $("#completeWork").modal();
    $('#formCompleteWork').attr('action', '/trabajos/completar/' + id);
}

//Funcion para revertir un trabajo
function progressWork(id) {
    $("#progressWork").modal();
    $('#formProgressWork').attr('action', '/trabajos/revertir/' + id);
}

//Funcion para aprovar un presupuesto
function approveBudget(slug) {
    $("#approveBudget").modal();
    $('#inputApproveBudget').val(slug);
}

//Funcion para registrar turno en presupuestos
function registerTurn(slug) {
    $("#registerTurn").modal();
    $('input[name="budget_id"]').val(slug);
}

//Funcion para editar turno en presupuestos
function editTurn(id) {
    $.ajax({
        url: '/agendas/ver',
        type: 'POST',
        dataType: 'html',
        data: {id: id},
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    })
    .done(function(resultado) {
        var obj=JSON.parse(resultado);
        if (obj.status) {
            if ($("#turnModal").length) {
                $("#turnModal").modal('hide');
            }
            $('#formEditTurn').attr('action', '/agendas/'+id);
            $('#formEditTurn input[name="title"]').val(obj.title);
            $('#formEditTurn textarea[name="description"]').val(obj.description);
            $('#formEditTurn input[name="date"]').val(obj.date);
            $('#formEditTurn input[name="time"]').val(obj.time);
            $("#editTurn").modal();
        }
    });
}

//Funcion para ver notificaciones
function notification(id) {
    $.ajax({
        url: '/notificaciones/ver',
        type: 'POST',
        dataType: 'html',
        data: {id: id},
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    })
    .done(function(resultado) {
        var obj=JSON.parse(resultado);
        if (obj.status) {
            $('#notificationTitle').text(obj.title);
            $('#notificationDescription').text(obj.description);
            $('#notificationTime').text(moment(obj.created_at.date).fromNow());
            $("#notificationsModal").modal();
        }
    });
}

//Funcion para eliminar imagenes de vehiculos
function deleteImageCreate(img){
    $("div[element="+img+"]").remove();
}

//funcion para eliminar imagenes de vehiculos
$('.removeImage').click(function(event) {
    var img=$(this).attr('image'), slug=$('#slug').val(), urlImage=event.currentTarget.attributes[3].value;
    urlImage=urlImage.split('/');
    if (slug!="") {
        $.ajax({
            url: '/imagenes/presupuestos/eliminar',
            type: 'POST',
            dataType: 'html',
            data: {slug: slug, url: urlImage[6]},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);
            if (obj.status) {
                $("div[element='"+img+"']").remove();
                Lobibox.notify('success', {
                    title: 'Eliminación Exitosa',
                    sound: true,
                    msg: 'La imagen ha sido eliminada exitosamente.'
                });
            } else {
                Lobibox.notify('error', {
                    title: 'Eliminación Fallida',
                    sound: true,
                    msg: 'Ha ocurrido un problema, intentelo nuevamente.'
                });
            }
        });
    }
});

//Funciones para agregar nuevo registro con ajax
//Localidades
$('#addLocality').click(function() {
    $('#localityAlertDanger, #localityAlertSuccess').addClass('d-none');
    $("#addLocalityModal").modal();
});

$('#submitLocality').click(function(event) {
    $('#localityErrors').addClass('d-none');
    $('#localityErrors').text('');
    var selectProvince=$('#multiselectProvinces option:selected').val();
    var locality=$('input[name="nameLocality"]').val();

    if (locality=="") {
        $('#localityErrors').removeClass('d-none');
        $('#localityErrors').text('Este campo es obligatorio.');
    } else if(locality.length<2) {
        $('#localityErrors').removeClass('d-none');
        $('#localityErrors').text('Escribe mínimo 2 caracteres.');
    } else if(locality.length>191) {
        $('#localityErrors').removeClass('d-none');
        $('#localityErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/localidades/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: locality, province_id: selectProvince},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                var id=$('#multiselectProvinces option:selected').val();
                if (obj.province_id==id) {
                    $('#multiselectLocalities').append($('<option>', {
                        value: obj.id,
                        text: obj.name
                    }));
                }
                $('input[name="nameLocality"]').val('');
                $('#localityAlertDanger').addClass('d-none');
                $('#localityAlertSuccess').removeClass('d-none');
            } else {
                $('#localityAlertSuccess').addClass('d-none');
                $('#localityAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Distritos
$('#addDistrict').click(function() {
    $('#districtAlertDanger, #districtAlertSuccess').addClass('d-none');
    $("#addDistrictModal").modal();
});

$('#submitDistrict').click(function(event) {
    $('#districtErrors').addClass('d-none');
    $('#districtErrors').text('');
    var selectLocality=$('#multiselectLocalities option:selected').val();
    var district=$('input[name="nameDistrict"]').val();
    
    if (district=="") {
        $('#districtErrors').removeClass('d-none');
        $('#districtErrors').text('Este campo es obligatorio.');
    } else if(district.length<2) {
        $('#districtErrors').removeClass('d-none');
        $('#districtErrors').text('Escribe mínimo 2 caracteres.');
    } else if(district.length>191) {
        $('#districtErrors').removeClass('d-none');
        $('#districtErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/distritos/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: district, locality_id: selectLocality},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                var id=$('#multiselectLocalities option:selected').val();
                if (obj.locality_id==id) {
                    $('#multiselectDistricts').append($('<option>', {
                        value: obj.id,
                        text: obj.name
                    }));
                }
                $('input[name="nameDistrict"]').val('');
                $('#districtAlertDanger').addClass('d-none');
                $('#districtAlertSuccess').removeClass('d-none');
            } else {
                $('#districtAlertSuccess').addClass('d-none');
                $('#districtAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Marcas
$('#addBrand').click(function() {
    $('#brandAlertDanger, #brandAlertSuccess').addClass('d-none');
    $("#addBrandModal").modal();
});

$('#submitBrand').click(function(event) {
    $('#brandErrors').addClass('d-none');
    $('#brandErrors').text('');
    var brand=$('input[name="nameBrand"]').val();    
    if (brand=="") {
        $('#brandErrors').removeClass('d-none');
        $('#brandErrors').text('Este campo es obligatorio.');
    } else if(brand.length<2) {
        $('#brandErrors').removeClass('d-none');
        $('#brandErrors').text('Escribe mínimo 2 caracteres.');
    } else if(brand.length>191) {
        $('#brandErrors').removeClass('d-none');
        $('#brandErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/marcas/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: brand},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                $('#multiselectBrands').append($('<option>', {
                    value: obj.id,
                    text: obj.name
                }));
                $('input[name="nameBrand"]').val('');
                $('#brandAlertDanger').addClass('d-none');
                $('#brandAlertSuccess').removeClass('d-none');
            } else {
                $('#brandAlertSuccess').addClass('d-none');
                $('#brandAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Modelos
$('#addModel').click(function() {
    $('#modelAlertDanger, #modelAlertSuccess').addClass('d-none');
    $("#addModelModal").modal();
});

$('#submitModel').click(function(event) {
    $('#modelErrors').addClass('d-none');
    $('#modelErrors').text('');
    var selectBrand=$('#multiselectBrands option:selected').val();
    var model=$('input[name="nameModel"]').val();
    
    if (model=="") {
        $('#modelErrors').removeClass('d-none');
        $('#modelErrors').text('Este campo es obligatorio.');
    } else if(model.length<2) {
        $('#modelErrors').removeClass('d-none');
        $('#modelErrors').text('Escribe mínimo 2 caracteres.');
    } else if(model.length>191) {
        $('#modelErrors').removeClass('d-none');
        $('#modelErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/modelos/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: model, brand_id: selectBrand},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                var id=$('#multiselectBrands option:selected').val();
                if (obj.brand_id==id) {
                    $('#multiselectModels').append($('<option>', {
                        value: obj.id,
                        text: obj.name
                    }));
                }
                $('input[name="nameModel"]').val('');
                $('#modelAlertDanger').addClass('d-none');
                $('#modelAlertSuccess').removeClass('d-none');
            } else {
                $('#modelAlertSuccess').addClass('d-none');
                $('#modelAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Versiones
$('#addVersion').click(function() {
    $('#versionAlertDanger, #versionAlertSuccess').addClass('d-none');
    $("#addVersionModal").modal();
});

$('#submitVersion').click(function(event) {
    $('#versionErrors').addClass('d-none');
    $('#versionErrors').text('');
    var selectModel=$('#multiselectModels option:selected').val();
    var version=$('input[name="nameVersion"]').val();

    if (version=="") {
        $('#versionErrors').removeClass('d-none');
        $('#versionErrors').text('Este campo es obligatorio.');
    } else if(version.length<2) {
        $('#versionErrors').removeClass('d-none');
        $('#versionErrors').text('Escribe mínimo 2 caracteres.');
    } else if(version.length>191) {
        $('#versionErrors').removeClass('d-none');
        $('#versionErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/versiones/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: version, model_id: selectModel},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                var id=$('#multiselectModels option:selected').val();
                if (obj.model_id==id) {
                    $('#multiselectVersions').append($('<option>', {
                        value: obj.id,
                        text: obj.name
                    }));
                }
                $('input[name="nameVersion"]').val('');
                $('#versionAlertDanger').addClass('d-none');
                $('#versionAlertSuccess').removeClass('d-none');
            } else {
                $('#versionAlertSuccess').addClass('d-none');
                $('#versionAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Partes
$('.addPart').click(function() {
    $('input[name="namePart"]').attr('part', $(this).attr('btn'));
    $('#partAlertDanger, #partAlertSuccess').addClass('d-none');
    $("#addPartModal").modal();
});

$('#submitPart').click(function(event) {
    $('#partErrors').addClass('d-none');
    $('#partErrors').text('');
    var part=$('input[name="namePart"]').val();
    var side=$('.side[side="'+$('input[name="namePart"]').attr('part')+'"]').val();

    if (part=="") {
        $('#partErrors').removeClass('d-none');
        $('#partErrors').text('Este campo es obligatorio.');
    } else if(part.length<2) {
        $('#partErrors').removeClass('d-none');
        $('#partErrors').text('Escribe mínimo 2 caracteres.');
    } else if(part.length>191) {
        $('#partErrors').removeClass('d-none');
        $('#partErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/partes/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: part, side: side},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                $('.side').each(function() {
                    if ($(this).val()==side) {
                        $('.part[part="'+$(this).attr('side')+'"]').append($('<option>', {
                            value: obj.slug,
                            text: obj.name
                        }));
                    }
                });
                $('input[name="namePart"]').val('');
                $('#partAlertDanger').addClass('d-none');
                $('#partAlertSuccess').removeClass('d-none');
            } else {
                $('#partAlertSuccess').addClass('d-none');
                $('#partAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Acciones
$('.addAction').click(function() {
    $('#actionAlertDanger, #actionAlertSuccess').addClass('d-none');
    $("#addActionModal").modal();
});

$('#submitAction').click(function(event) {
    $('#actionErrors').addClass('d-none');
    $('#actionErrors').text('');
    var action=$('input[name="nameAction"]').val();

    if (action=="") {
        $('#actionErrors').removeClass('d-none');
        $('#actionErrors').text('Este campo es obligatorio.');
    } else if(action.length<2) {
        $('#actionErrors').removeClass('d-none');
        $('#actionErrors').text('Escribe mínimo 2 caracteres.');
    } else if(action.length>191) {
        $('#actionErrors').removeClass('d-none');
        $('#actionErrors').text('Escribe máximo 191 caracteres.');
    } else {
        $.ajax({
            url: '/acciones/nuevo',
            type: 'POST',
            dataType: 'html',
            data: {name: action},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            var obj=JSON.parse(resultado);

            if (obj.status) {
                $('.action').each(function() {
                    $(this).append($('<option>', {
                        value: obj.slug,
                        text: obj.name
                    }));
                });
                $('input[name="nameAction"]').val('');
                $('#actionAlertDanger').addClass('d-none');
                $('#actionAlertSuccess').removeClass('d-none');
            } else {
                $('#actionAlertSuccess').addClass('d-none');
                $('#actionAlertDanger').removeClass('d-none');
            }
        });
    }
});

//Agregar partes de vehículo por el lado en presupuestos y trabajos/incidentes
$('.side').change(function() {
    var val=$(this).val();
    var side=$(this).attr('side');
    if (val!="") {
        $.ajax({
            url: '/partes/agregar',
            type: 'POST',
            dataType: 'html',
            data: {name: val},
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        })
        .done(function(resultado) {
            $(".part[part='"+side+"'] option").remove();
            $(".part[part='"+side+"']").attr('disabled', true);
            var obj=JSON.parse(resultado);

            $(".part[part='"+side+"']").append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));
            for (var i=obj.length-1; i>=0; i--) {
                $(".part[part='"+side+"']").append($('<option>', {
                    value: obj[i].slug,
                    text: obj[i].name
                }));
            }
            $(".part[part='"+side+"']").attr('disabled', false);
            $(".addPart[btn='"+side+"']").removeClass('d-none');
        });
    } else {
        $(".part[part='"+side+"'] option").remove();
        $(".part[part='"+side+"']").append($('<option>', {
            value: '',
            text: 'Seleccione'
        }));
        $(".part[part='"+side+"']").attr('disabled', true);
        $(".addPart[btn='"+side+"']").addClass('d-none');
    }
});

//Habilitar la acción en presupuesto y trabajos/incidentes
$('.part').change(function() {
    var val=$(this).val();
    var part=$(this).attr('part');
    if (val!="") {
        $(".action[action='"+part+"']").attr('disabled', false);
        $(".addAction[btn='"+part+"']").removeClass('d-none');
    } else {
        $(".action[action='"+part+"']").val('');
        $(".action[action='"+part+"']").attr('disabled', true);
        $(".addAction[btn='"+part+"']").addClass('d-none');
    }
});

//Agregar tarea en presupuesto y trabajos/incidentes
$('#addTask').click(function() {
    var side=parseInt($(".side:last").attr('side'), 10)+1;
    $("#newTask").append($('<div>', {
        class: "form-group col-lg-4 col-md-4 col-12 task",
        task: side
    }).append($('<label>', {
        class: "col-form-label",
        text: "Lado"
    }).append($('<b>', {
        class: "text-danger",
        text: "*"
    }))).append($('<select>', {
        class: "form-control side",
        name: "side[]",
        required: "required",
        side: side
    }).append($('<option>', {
        value: '',
        text: 'Seleccione'
    })).append($('<option>', {
        value: 'Techo',
        text: 'Techo'
    })).append($('<option>', {
        value: 'Delantero',
        text: 'Delantero'
    })).append($('<option>', {
        value: 'Lateral Izquierdo',
        text: 'Lateral Izquierdo'
    })).append($('<option>', {
        value: 'Lateral Derecho',
        text: 'Lateral Derecho'
    })).append($('<option>', {
        value: 'Trasero',
        text: 'Trasero'
    }))));

    //Habilitar las partes en presupuesto y trabajos/incidentes en el nuevo campo
    $('.side:last').on("change", function() {
        var val=$(this).val();
        var side=$(this).attr('side');
        if (val!="") {
            $.ajax({
                url: '/partes/agregar',
                type: 'POST',
                dataType: 'html',
                data: {name: val},
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            })
            .done(function(resultado) {
                $(".part[part='"+side+"'] option").remove();
                $(".part[part='"+side+"']").attr('disabled', true);
                var obj=JSON.parse(resultado);

                $(".part[part='"+side+"']").append($('<option>', {
                    value: '',
                    text: 'Seleccione'
                }));
                for (var i=obj.length-1; i>=0; i--) {
                    $(".part[part='"+side+"']").append($('<option>', {
                        value: obj[i].slug,
                        text: obj[i].name
                    }));
                }
                $(".part[part='"+side+"']").attr('disabled', false);
                $(".addPart[btn='"+side+"']").removeClass('d-none');
            });
        } else {
            $(".part[part='"+side+"'] option").remove();
            $(".part[part='"+side+"']").append($('<option>', {
                value: '',
                text: 'Seleccione'
            }));
            $(".part[part='"+side+"']").attr('disabled', true);
            $(".addPart[btn='"+side+"']").addClass('d-none');
        }
    });

    $("#newTask").append($('<div>', {
        class: "form-group col-lg-4 col-md-4 col-12 task",
        task: side
    }).append($('<label>', {
        class: "col-form-label",
        text: "Parte del Vehículo"
    }).append($('<b>', {
        class: "text-danger",
        text: "*"
    })).append($('<button>', {
        type: "button",
        class: "btn btn-sm btn-primary ml-2 d-none addPart",
        text: "Agregar",
        btn: side
    }))).append($('<select>', {
        class: "form-control part",
        name: "part_id[]",
        required: "required",
        disabled: "disabled",
        part: side
    }).append($('<option>', {
        value: '',
        text: 'Seleccione'
    }))));

    //Partes
    $('.addPart').on("click", function() {
        $('input[name="namePart"]').attr('part', $(this).attr('btn'));
        $('#partAlertDanger, #partAlertSuccess').addClass('d-none');
        $("#addPartModal").modal();
    });

    //Habilitar la acción en presupuesto y trabajos/incidentes en el nuevo campo
    $('.part:last').on("change", function() {
        var val=$(this).val();
        var part=$(this).attr('part');
        if (val!="") {
            $(".action[action='"+part+"']").attr('disabled', false);
            $(".addAction[btn='"+part+"']").removeClass('d-none');
        } else {
            $(".action[action='"+part+"']").val('');
            $(".action[action='"+part+"']").attr('disabled', true);
            $(".addAction[btn='"+part+"']").addClass('d-none');
        }
    });

    $("#newTask").append($('<div>', {
        class: "form-group col-lg-3 col-md-3 col-12 task",
        task: side
    }).append($('<label>', {
        class: "col-form-label",
        text: "Acción"
    }).append($('<b>', {
        class: "text-danger",
        text: "*"
    })).append($('<button>', {
        type: "button",
        class: "btn btn-sm btn-primary ml-2 d-none addAction",
        text: "Agregar",
        btn: side
    }))).append($('<select>', {
        class: "form-control action",
        name: "action_id[]",
        required: "required",
        disabled: "disabled",
        action: side
    }).append($('<option>', {
        value: '',
        text: 'Seleccione'
    }))));

    //Acciones
    $('.addAction').on("click", function() {
        $('#actionAlertDanger, #actionAlertSuccess').addClass('d-none');
        $("#addActionModal").modal();
    });

    $.ajax({
        url: '/acciones/agregar',
        type: 'POST',
        dataType: 'html',
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    })
    .done(function(resultado) {
        var obj=JSON.parse(resultado);
        for (var i=obj.length-1; i>=0; i--) {
            $(".action[action='"+side+"']").append($('<option>', {
                value: obj[i].slug,
                text: obj[i].name
            }));
        }
    });

    $("#newTask").append($('<div>', {
        class: "form-group col-lg-1 col-md-1 col-12 task",
        task: side
    }).append($('<button>', {
        type: "button",
        class: "btn btn-danger deleteTask",
        task: side
    }).append($('<i>', {
        class: "fa fa-close"
    }))));

    //Quitar tarea de presupuestos y trabajos/incidentes
    $('.deleteTask').on("click", function() {
        var task=$(this).attr('task');
        $('.task[task="'+task+'"]').remove();
    });
});

//Quitar tarea de presupuestos y trabajos/incidentes
$('.deleteTask').click(function() {
    var task=$(this).attr('task');
    $('.task[task="'+task+'"]').remove();
});

$('input[name="price_lock"]').change(function() {
    if ($(this).val()!="") {
        lock=parseInt($(this).val(), 10);
    } else {
        lock=0;
    }
    var paint=parseInt($('input[name="price_paint"]').val(), 10), mechanics=parseInt($('input[name="price_mechanics"]').val(), 10), spare=parseInt($('input[name="price_spare"]').val(), 10), total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_lock"]').keyup(function() {
    if ($(this).val()!="") {
        lock=parseInt($(this).val(), 10);
    } else {
        lock=0;
    }
    var paint=parseInt($('input[name="price_paint"]').val(), 10), mechanics=parseInt($('input[name="price_mechanics"]').val(), 10), spare=parseInt($('input[name="price_spare"]').val(), 10),total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_paint"]').change(function() {
    if ($(this).val()!="") {
        paint=parseInt($(this).val(), 10);
    } else {
        paint=0;
    }
    var lock=parseInt($('input[name="price_lock"]').val(), 10), mechanics=parseInt($('input[name="price_mechanics"]').val(), 10), spare=parseInt($('input[name="price_spare"]').val(), 10), total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_paint"]').keyup(function() {
    if ($(this).val()!="") {
        paint=parseInt($(this).val(), 10);
    } else {
        paint=0;
    }
    var lock=parseInt($('input[name="price_lock"]').val(), 10), mechanics=parseInt($('input[name="price_mechanics"]').val(), 10), spare=parseInt($('input[name="price_spare"]').val(), 10),total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_mechanics"]').change(function() {
    if ($(this).val()!="") {
        mechanics=parseInt($(this).val(), 10);
    } else {
        mechanics=0;
    }
    var paint=parseInt($('input[name="price_paint"]').val(), 10), lock=parseInt($('input[name="price_lock"]').val(), 10), spare=parseInt($('input[name="price_spare"]').val(), 10), total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_mechanics"]').keyup(function() {
    if ($(this).val()!="") {
        mechanics=parseInt($(this).val(), 10);
    } else {
        mechanics=0;
    }
    var paint=parseInt($('input[name="price_paint"]').val(), 10), lock=parseInt($('input[name="price_lock"]').val(), 10), spare=parseInt($('input[name="price_spare"]').val(), 10),total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_spare"]').change(function() {
    if ($(this).val()!="") {
        spare=parseInt($(this).val(), 10);
    } else {
        spare=0;
    }
    var paint=parseInt($('input[name="price_paint"]').val(), 10), mechanics=parseInt($('input[name="price_mechanics"]').val(), 10), lock=parseInt($('input[name="price_lock"]').val(), 10), total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

$('input[name="price_spare"]').keyup(function() {
    if ($(this).val()!="") {
        spare=parseInt($(this).val(), 10);
    } else {
        spare=0;
    }
    var paint=parseInt($('input[name="price_paint"]').val(), 10), mechanics=parseInt($('input[name="price_mechanics"]').val(), 10), lock=parseInt($('input[name="price_lock"]').val(), 10),total=0;
    $('#total').val(lock+paint+mechanics+spare);
});

//Email de presupuesto
function emailBudget(slug) {
    $("#budgetEmailModal").modal();
    $('#formBudgetEmail').attr('action', '/presupuestos/'+slug+'/email');

}

$("#typePay").on('change',function(){

    var selectValue = $(this).val();
    switch (selectValue) {

        case "":
        $("#one").css('display','none');
        $("#two").css('display','none');
        $("#three").css('display','none');
        break;

        case "EFECTIVO":
        $("#one").css('display','none');
        $("#two").css('display','block');
        $("#three").css('display','block');
        break;

        case "TC":
        $("#one").css('display','block');
        $("#two").css('display','none');
        $("#three").css('display','none');
        break;

        case "TD":
        $("#one").css('display','block');
        $("#two").css('display','none');
        $("#three").css('display','none');
        break;

    }

}).change();

